<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <title>–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è –≤ –¥–∂—É–Ω–≥–ª–∞—Ç–∞ - –ë–ò–ù–ì–û</title>
    <style>
        /* –û–°–ù–û–í–ï–ù –î–ò–ó–ê–ô–ù –ù–ê –ò–ì–†–ê–¢–ê */
        :root {
            --wood-dark: #3e2723;
            --jungle-bg: #e8f5e9;
            --accent-orange: #ff6d00;
        }

        body, html {
            margin: 0; padding: 0; height: 100vh;
            font-family: 'Arial Black', sans-serif;
            background: #1b5e20; 
            background: url('–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è –≤ –¥–∂—É–Ω–≥–ª–∞—Ç–∞.png') no-repeat center center fixed;
            background-size: cover;
            overflow: hidden;
        }

        #intro-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.85);
            display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 5000;
            text-align: center;
        }

        .instructions-box {
            background: white; border: 8px solid var(--accent-orange);
            padding: 40px; border-radius: 30px; max-width: 700px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2); margin-bottom: 30px;
        }

        .btn-3d {
            padding: 20px 60px; font-size: 28px; border-radius: 50px; border: none;
            cursor: pointer; font-weight: bold; margin: 15px;
            transition: all 0.1s; text-transform: uppercase;
        }
        .btn-start { background: #4caf50; color: white; box-shadow: 0 10px #2e7d32; }
        .btn-start:active { transform: translateY(5px); box-shadow: 0 5px #2e7d32; }
        
        /* –ë—É—Ç–æ–Ω –∑–∞ –ø—Ä–∏–Ω—Ç–∏—Ä–∞–Ω–µ */
        .btn-print { background: #2196f3; color: white; box-shadow: 0 10px #1976d2; font-size: 20px; padding: 15px 40px; }
        .btn-print:active { transform: translateY(5px); box-shadow: 0 5px #1976d2; }

        #game-container { display: none; height: 100vh; align-items: center; justify-content: space-around; padding: 20px; }

        #lotto-sphere {
            width: 480px; height: 480px; background: rgba(255,255,255,0.2);
            border: 15px solid white; border-radius: 50%; position: relative; overflow: hidden;
            box-shadow: 0 0 50px rgba(0,0,0,0.3);
        }

        .ball {
            position: absolute; width: 45px; height: 45px; 
            background: radial-gradient(circle at 35% 35%, #ffffff 0%, #ffecd2 30%, #f2994a 80%, #e67e22 100%);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            color: #3e2723; font-weight: bold; font-size: 16px; box-shadow: 2px 4px 8px rgba(0,0,0,0.5);
        }

        #riddle-board {
            width: 700px; height: 400px; background: #fffef0; border: 18px solid var(--wood-dark);
            border-radius: 35px; display: flex; align-items: center; justify-content: center;
            padding: 40px; box-sizing: border-box; box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        #draw-btn-game {
            background: var(--accent-orange); color: white; font-size: 35px;
            padding: 25px 80px; border: none; border-radius: 60px;
            box-shadow: 0 12px #bf360c; cursor: pointer; font-weight: bold; margin-top: 40px;
        }
        #draw-btn-game:disabled { background: #ccc; box-shadow: none; cursor: default; }

        #history-screen, #history-content { display: none; } /* –°–∫—Ä–∏—Ç–∏ –ø–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ */

        #history-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.9); z-index: 6000; padding: 50px; box-sizing: border-box;
            flex-wrap: wrap; justify-content: center; align-content: flex-start; gap: 20px;
            overflow-y: auto;
        }
        .history-card {
            width: 120px; height: 120px; background: white; border-radius: 15px;
            display: flex; align-items: center; justify-content: center; font-size: 70px;
        }
        .close-history {
            position: fixed; top: 20px; right: 20px; padding: 15px 30px;
            background: var(--accent-orange); color: white; border: none; border-radius: 10px;
            font-weight: bold; cursor: pointer;
        }
        .footer { position: absolute; bottom: 20px; width: 100%; text-align: center; color: #333; font-size: 14px; }

        /* –°–¢–ò–õ–û–í–ï –ó–ê –ü–ï–ß–ê–¢ (–î–ò–†–ï–ö–¢–ù–û –û–¢ –í–¢–û–†–ò–Ø –§–ê–ô–õ) */
        #print-area { display: none; }

        @media print {
            body * { visibility: hidden; }
            #print-area, #print-area * { visibility: visible; }
            #print-area { display: block !important; position: absolute; left: 0; top: 0; width: 100%; }
            .page {
                width: 210mm; height: 297mm; background: white; margin: 0;
                padding: 10mm; box-sizing: border-box; display: flex; flex-direction: column;
                justify-content: space-around; page-break-after: always;
            }
            .ticket {
                width: 190mm; height: 132mm; border: 2px solid #999; border-radius: 12px;
                display: flex; overflow: hidden; background: #fff !important;
                box-shadow: none; box-sizing: border-box; margin-bottom: 5mm;
            }
            .sidebar {
                width: 32mm; background: #e0e0e0 !important; color: #333;
                display: flex; align-items: center; justify-content: center;
                border-right: 1px solid #ccc; -webkit-print-color-adjust: exact;
            }
            .sidebar-text {
                transform: rotate(-90deg); white-space: nowrap;
                font-family: 'Arial Black', sans-serif; font-size: 30px;
                text-transform: uppercase; letter-spacing: 2px;
                text-align: center; line-height: 1.1;
            }
            .main-content { flex-grow: 1; padding: 12px; display: flex; flex-direction: column; }
            .grid {
                display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;
                justify-items: center; align-items: center; flex-grow: 1;
            }
            .cell {
                width: 42mm; height: 32mm; background: #fff; border: 1px solid #ddd;
                border-radius: 10px; display: flex; align-items: center; justify-content: center;
            }
            .icon-bg {
                width: 28mm; height: 28mm; background: #f2f2f2 !important;
                border-radius: 50%; display: flex; align-items: center; justify-content: center;
                font-size: 50px; -webkit-print-color-adjust: exact;
            }
            .ticket-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; margin-bottom: 10px; }
            .ticket-no { font-weight: bold; font-size: 18px; }
            .footer-ticket { margin-top: 8px; font-size: 11px; color: #888; display: flex; justify-content: space-between; border-top: 1px solid #eee; }
        }
    </style>
</head>
<body>

    <div id="intro-screen">
        <div class="instructions-box">
            <h1 style="color: #2e7d32; font-size: 45px; margin-top: 0;">–ñ–ò–í–û–¢–ù–ò - –ë–ò–ù–ì–û</h1>
            <p style="font-size: 22px; color: #555;">–ü–æ–∑–Ω–∞–π –∂–∏–≤–æ—Ç–Ω–æ—Ç–æ –æ—Ç –≥–∞—Ç–∞–Ω–∫–∞—Ç–∞ –∏ –∑–∞—á–µ—Ä–∫–Ω–∏ –≤ —Å–≤–æ—è –±–∏–ª–µ—Ç!</p>
        </div>
        <div style="display: flex; gap: 20px; align-items: center;">
            <button class="btn-3d btn-start" onclick="startGame()">–°—Ç–∞—Ä—Ç</button>
            <button class="btn-3d btn-print" onclick="prepareAndPrint()">–ü—Ä–∏–Ω—Ç–∏—Ä–∞–π –±–∏–ª–µ—Ç–∏</button>
        </div>
        <div class="footer">–ò–∑—Ä–∞–±–æ—Ç–∏–ª: –î–æ—á–∫–∞ –ö—é—á—É–∫–æ–≤–∞ | 2026</div>
    </div>

    <div id="game-container">
        <div style="text-align:center;">
            <div id="lotto-sphere"></div>
            <button onclick="openHistory()" style="margin-top:20px; cursor:pointer; background:#fff; border:3px solid var(--wood-dark); border-radius:15px; padding:10px 20px; font-weight:bold;">üìã –ü–†–û–í–ï–†–ö–ê</button>
        </div>
        <div style="text-align:center;">
            <div id="riddle-board">
                <h2 id="riddle-text" style="font-size: 34px; color: #1b5e20; text-align: center;">–ì–æ—Ç–æ–≤–∏ –ª–∏ —Å—Ç–µ?</h2>
            </div>
            <button id="draw-btn-game" onclick="drawBall()">–ò–ó–¢–ï–ì–õ–ò</button>
        </div>
        <div class="footer">–ò–∑—Ä–∞–±–æ—Ç–∏–ª: –î–æ—á–∫–∞ –ö—é—á—É–∫–æ–≤–∞</div>
    </div>

    <div id="history-screen">
        <button class="close-history" onclick="closeHistory()">–í–™–†–ù–ò –°–ï</button>
        <div id="history-content" style="display:contents;"></div>
    </div>

    <div id="print-area"></div>

    <script>
        const animalsData = [
            {q: "–ü–∞–∑—è –∫—ä—â–∞—Ç–∞ –∏ –ª–∞—è: –ë–∞—É-–±–∞—É!", a: "üê∂"},
            {q: "–î–∞–≤–∞–º –º–ª—è–∫–æ –∏ –∫–∞–∑–≤–∞–º: –ú—É—É—É—É!", a: "üêÆ"},
            {q: "–û–±–∏—á–∞–º –º–µ–¥ –∏ —Å–ø—è –≤ –±—ä—Ä–ª–æ–≥–∞.", a: "üêª"},
            {q: "–•–∏—Ç—Ä–∞ —Å—ä–º –∏ –∏–º–∞–º –ø—É—Ö–∫–∞–≤–∞ –æ–ø–∞—à–∫–∞.", a: "ü¶ä"},
            {q: "–ò–º–∞–º –¥—ä–ª–≥–∏ —É—à–∏ –∏ —è–º –º–æ—Ä–∫–æ–≤–∏.", a: "üê∞"},
            {q: "–í–∏—è –∫—ä–º –ª—É–Ω–∞—Ç–∞ –≤ –≥–æ—Ä–∞—Ç–∞.", a: "üê∫"},
            {q: "–ò–º–∞–º –±–æ–¥–ª–∏ –∏ —Å—Ç–∞–≤–∞–º –Ω–∞ –∫—ä–ª–±–æ.", a: "ü¶î"},
            {q: "–ù–æ—Å—è –≥–æ–ª–µ–º–∏ —Ä–æ–≥–∞ –∏ —Ç–∏—á–∞–º –±—ä—Ä–∑–æ.", a: "ü¶å"},
            {q: "–ú—ä—Ä–∫–∞–º –∏ –ª–æ–≤—è –º–∏—à–∫–∏.", a: "üê±"},
            {q: "–ë—É–¥—è –≤—Å–∏—á–∫–∏ —Å—É—Ç—Ä–∏–Ω: –ö—É–∫—É—Ä–∏–≥—É!", a: "üêì"},
            {q: "–ò–º–∞–º —Ö–æ–±–æ—Ç –∏ –≥–æ–ª–µ–º–∏ —É—à–∏.", a: "üêò"},
            {q: "–ê–∑ —Å—ä–º —Ü–∞—Ä—è—Ç –Ω–∞ –∂–∏–≤–æ—Ç–Ω–∏—Ç–µ.", a: "ü¶Å"},
            {q: "–î–∞–≤–∞–º –≤—ä–ª–Ω–∞ –∑–∞ —Ç–æ–ø–ª–∏ —á–æ—Ä–∞–ø–∏.", a: "üêë"},
            {q: "–ü—Ä–µ–ø—É—Å–∫–∞–º –±—ä—Ä–∑–æ –∏ –∏–º–∞–º –≥—Ä–∏–≤–∞.", a: "üê¥"},
            {q: "–û–ø–∞—à–∫–∞—Ç–∞ –º–∏ –µ –Ω–∞–≤–∏—Ç–∞ –Ω–∞–∫—Ä–∞—è.", a: "üê∑"},
            {q: "–°–Ω–∞—Å—è–º —è–π—Ü–∞ –∏ –∫—ä–ª–≤–∞ –∑—Ä—ä–Ω—Ü–∞.", a: "üêî"},
            {q: "–ò–º–∞–º –º–Ω–æ–≥–æ –¥—ä–ª–≥–∞ —à–∏—è.", a: "ü¶í"},
            {q: "–ë—É–¥–Ω–∞ —Å—ä–º –Ω–æ—â–µ–º: –•—É-—Ö—É!", a: "ü¶â"},
            {q: "–°–∫–∞—á–∞–º –ø–æ –∫–ª–æ–Ω–∏—Ç–µ –∏ —è–º –ª–µ—à–Ω–∏—Ü–∏.", a: "üêøÔ∏è"},
            {q: "–ù–∞ —Ä–∞–π–µ—Ç–∞ —Å—ä–º –æ—Ü–≤–µ—Ç–µ–Ω–∞, –≤ –ê—Ñ—Ä–∏–∫–∞ —Å—ä–º –∞–∑ —Ä–æ–¥–µ–Ω–∞.", a: "ü¶ì"}
        ];

        const allIcons = animalsData.map(item => item.a);
        let pool = [...animalsData];
        const balls = [];
        const sphere = document.getElementById('lotto-sphere');
        let audioCtx;

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function playHistoryStyleSound(f, d) {
            if (!audioCtx) return;
            const o = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            o.connect(g); g.connect(audioCtx.destination);
            o.frequency.value = f;
            g.gain.setValueAtTime(0.05, audioCtx.currentTime);
            o.start(); o.stop(audioCtx.currentTime + d);
        }

        function startGame() {
            initAudio();
            document.getElementById('intro-screen').style.display = 'none';
            document.getElementById('game-container').style.display = 'flex';
            if (audioCtx.state === 'suspended') audioCtx.resume();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ —Ç–æ–ø–∫–∏—Ç–µ –≤ —Å—Ñ–µ—Ä–∞—Ç–∞
        for (let i = 0; i < 20; i++) {
            const ballEl = document.createElement('div');
            ballEl.className = 'ball'; ballEl.innerText = i + 1;
            ballEl.style.left = Math.random() * 380 + 'px';
            ballEl.style.top = Math.random() * 380 + 'px';
            sphere.appendChild(ballEl);
            balls.push({ el: ballEl, x: Math.random() * 2 - 1, y: Math.random() * 2 - 1, s: 1 });
        }

        function animate() {
            balls.forEach(b => {
                let curX = parseFloat(b.el.style.left), curY = parseFloat(b.el.style.top);
                if (curX <= 0 || curX >= 410) b.x *= -1;
                if (curY <= 0 || curY >= 410) b.y *= -1;
                b.el.style.left = (curX + b.x * b.s) + 'px';
                b.el.style.top = (curY + b.y * b.s) + 'px';
            });
            requestAnimationFrame(animate);
        }
        animate();

        function drawBall() {
            if (pool.length === 0) return alert("–í—Å–∏—á–∫–∏ –≥–∞—Ç–∞–Ω–∫–∏ —Å–∞ –∏–∑—Ç–µ–≥–ª–µ–Ω–∏!");
            const btn = document.getElementById('draw-btn-game');
            btn.disabled = true;

            const mixSound = setInterval(() => {
                playHistoryStyleSound(150 + Math.random() * 250, 0.05);
            }, 80);

            balls.forEach(b => b.s = 18);
            
            setTimeout(() => {
                clearInterval(mixSound);
                balls.forEach(b => b.s = 1);
                playHistoryStyleSound(440, 0.2);

                const idx = Math.floor(Math.random() * pool.length);
                const picked = pool.splice(idx, 1)[0];
                document.getElementById('riddle-text').innerText = picked.q;
                
                const card = document.createElement('div');
                card.className = 'history-card'; card.innerText = picked.a;
                document.getElementById('history-content').appendChild(card);

                const visible = balls.filter(b => b.el.style.display !== 'none');
                if (visible.length) visible[0].el.style.display = 'none';
                
                btn.disabled = false;
            }, 1200);
        }

        function openHistory() { document.getElementById('history-screen').style.display = 'flex'; }
        function closeHistory() { document.getElementById('history-screen').style.display = 'none'; }

        // –§–£–ù–ö–¶–ò–Ø –ó–ê –ì–ï–ù–ï–†–ò–†–ê–ù–ï –ò –ü–ï–ß–ê–¢ –ù–ê –ë–ò–õ–ï–¢–ò
        function prepareAndPrint() {
            const printArea = document.getElementById('print-area');
            printArea.innerHTML = ''; // –ò–∑—á–∏—Å—Ç–≤–∞–Ω–µ
            
            // –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ 10 —Å—Ç—Ä–∞–Ω–∏—Ü–∏ (–æ–±—â–æ 20 –±–∏–ª–µ—Ç–∞)
            for (let p = 0; p < 10; p++) {
                const page = document.createElement('div');
                page.className = 'page';
                
                for (let t = 0; t < 2; t++) {
                    const ticketID = (p * 2) + t + 1;
                    const shuffled = [...allIcons].sort(() => 0.5 - Math.random()).slice(0, 9);
                    
                    page.innerHTML += `
                        <div class="ticket">
                            <div class="sidebar">
                                <div class="sidebar-text">–ë–ò–ù–ì–û<br>–°–õ–ï–î–û–¢–™–†–°–ê–ß</div>
                            </div>
                            <div class="main-content">
                                <div class="ticket-header">
                                    <div class="ticket-no">–ë–ò–õ–ï–¢ ‚Ññ${ticketID}</div>
                                    <div style="font-size: 11px; color: #666; font-family: sans-serif;">–°–ª—É—à–∞–π –≤–Ω–∏–º–∞—Ç–µ–ª–Ω–æ –∏ –∑–∞—á–µ—Ä–∫–Ω–∏!</div>
                                </div>
                                <div class="grid">
                                    ${shuffled.map(a => `
                                        <div class="cell">
                                            <div class="icon-bg">${a}</div>
                                        </div>
                                    `).join('')}
                                </div>
                                <div class="footer-ticket">
                                    <span style="font-family: sans-serif;">–ò–∑—Ä–∞–±–æ—Ç–∏–ª: –î–æ—á–∫–∞ –ö—é—á—É–∫–æ–≤–∞</span>
                                    <span style="font-family: sans-serif;">–ë–∏–Ω–≥–æ –ò–≥—Ä–∏ 2026</span>
                                </div>
                            </div>
                        </div>
                    `;
                }
                printArea.appendChild(page);
            }
            window.print();
        }
    </script>
</body>
</html>